# Chapter 06: Vector å‘é‡åŒ–æŠ€æœ¯ä¸è¯­ä¹‰æœç´¢ ğŸ”

> æ·±å…¥ç†è§£å‘é‡åŒ–æŠ€æœ¯ã€æ–‡æ¡£æ£€ç´¢ã€RAG ç³»ç»Ÿï¼ŒæŒæ¡ä»åŸºç¡€åˆ°å®æˆ˜çš„å®Œæ•´è¯­ä¹‰æœç´¢è§£å†³æ–¹æ¡ˆ

## ğŸ“š ç›®å½•

- [ä»€ä¹ˆæ˜¯å‘é‡åŒ–ï¼Ÿ](#ä»€ä¹ˆæ˜¯å‘é‡åŒ–)
- [ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æœç´¢ï¼Ÿ](#ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æœç´¢)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒæ¦‚å¿µè¯¦è§£](#æ ¸å¿ƒæ¦‚å¿µè¯¦è§£)
- [ä»£ç ç¤ºä¾‹è¯¦è§£](#ä»£ç ç¤ºä¾‹è¯¦è§£)
- [å®æˆ˜é¡¹ç›®](#å®æˆ˜é¡¹ç›®)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ¯ ä»€ä¹ˆæ˜¯å‘é‡åŒ–ï¼Ÿ

### æ ¸å¿ƒé—®é¢˜

ä¼ ç»Ÿçš„å…³é”®è¯æœç´¢æ— æ³•ç†è§£è¯­ä¹‰ï¼š

```typescript
// âŒ å…³é”®è¯æœç´¢çš„å±€é™
æœç´¢: "å¦‚ä½•æå‡ç½‘ç«™æ€§èƒ½"
ç»“æœ: åªèƒ½åŒ¹é…åŒ…å«"æå‡"ã€"ç½‘ç«™"ã€"æ€§èƒ½"è¿™äº›è¯çš„æ–‡æ¡£

é—®é¢˜:
- æ— æ³•åŒ¹é…åŒä¹‰è¯ï¼ˆ"ä¼˜åŒ–" vs "æå‡"ï¼‰
- æ— æ³•ç†è§£è¯­ä¹‰ï¼ˆ"åŠ é€Ÿç½‘é¡µåŠ è½½" vs "æå‡ç½‘ç«™æ€§èƒ½"ï¼‰
- æ— æ³•å¤„ç†é•¿å°¾æŸ¥è¯¢
```

### è§£å†³æ–¹æ¡ˆ

å‘é‡åŒ–å°†æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡ï¼Œè¯­ä¹‰ç›¸ä¼¼çš„æ–‡æœ¬åœ¨å‘é‡ç©ºé—´ä¸­è·ç¦»æ›´è¿‘ï¼š

```typescript
// âœ… å‘é‡æœç´¢ï¼šç†è§£è¯­ä¹‰
æ–‡æœ¬1: "å¦‚ä½•æå‡ç½‘ç«™æ€§èƒ½" â†’ [0.23, 0.45, 0.12, ..., 0.89] (1536ç»´)
æ–‡æœ¬2: "ç½‘é¡µåŠ è½½é€Ÿåº¦ä¼˜åŒ–" â†’ [0.25, 0.43, 0.15, ..., 0.87] (1536ç»´)
æ–‡æœ¬3: "ä»Šå¤©å¤©æ°”çœŸå¥½" â†’ [0.89, -0.12, 0.34, ..., -0.23] (1536ç»´)

ç›¸ä¼¼åº¦:
æ–‡æœ¬1 vs æ–‡æœ¬2: 0.95 â­ è¯­ä¹‰ç›¸ä¼¼
æ–‡æœ¬1 vs æ–‡æœ¬3: 0.12 âŒ è¯­ä¹‰ä¸ç›¸å…³
```

### é¡¹ç›®ç»“æ„

```
src/ch06/
â”œâ”€â”€ loaders.ts                    # ğŸ“„ æ–‡æ¡£åŠ è½½å™¨
â”œâ”€â”€ chunk.ts                      # âœ‚ï¸  æ–‡æ¡£åˆ†å—å·¥å…·
â”œâ”€â”€ simple-vector-store.ts        # ğŸ’¾ ç®€å•å‘é‡å­˜å‚¨
â”œâ”€â”€ embedding-basic.ts            # ğŸ¯ å‘é‡åŒ–åŸºç¡€ç¤ºä¾‹
â”œâ”€â”€ vector-search.ts              # ğŸ” å‘é‡æœç´¢ç¤ºä¾‹
â”œâ”€â”€ hybrid-search.ts              # ğŸ”€ æ··åˆæœç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
â”œâ”€â”€ rag-qa.ts                     # ğŸ’¬ RAG é—®ç­”ç³»ç»Ÿ
â”œâ”€â”€ enterprise-search/            # ğŸ¢ ä¼ä¸šæ–‡æ¡£æœç´¢é¡¹ç›®
â”‚   â””â”€â”€ search-engine.ts
â””â”€â”€ README.md                     # ğŸ“– å®Œæ•´æ•™ç¨‹æ–‡æ¡£
```

---

## ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æœç´¢ï¼Ÿ

### 1. è¯­ä¹‰ç†è§£èƒ½åŠ›

**åœºæ™¯**ï¼šç”¨æˆ·æœç´¢æŠ€æœ¯æ–‡æ¡£

```
æŸ¥è¯¢ï¼š"React æ€§èƒ½ä¼˜åŒ–"

å…³é”®è¯æœç´¢ç»“æœï¼š
âŒ "React ä½¿ç”¨æŒ‡å—"ï¼ˆåŒ…å« Reactï¼‰
âŒ "æ€§èƒ½æµ‹è¯•å·¥å…·"ï¼ˆåŒ…å«æ€§èƒ½ï¼‰
âŒ "ä»£ç ä¼˜åŒ–æŠ€å·§"ï¼ˆåŒ…å«ä¼˜åŒ–ï¼‰

å‘é‡æœç´¢ç»“æœï¼š
âœ… "æå‡ React åº”ç”¨æ€§èƒ½çš„10ä¸ªæŠ€å·§"ï¼ˆè¯­ä¹‰åŒ¹é…ï¼‰
âœ… "React.memo å’Œ useMemo çš„ä½¿ç”¨"ï¼ˆç›¸å…³æŠ€æœ¯ï¼‰
âœ… "è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–å¤§æ•°æ®æ¸²æŸ“"ï¼ˆç›¸å…³åœºæ™¯ï¼‰
```

### 2. å¤šè¯­è¨€æ”¯æŒ

å‘é‡åŒ–å¯ä»¥ç†è§£ä¸åŒè¯­è¨€é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ï¼š

```typescript
è‹±æ–‡: "How to optimize React performance"
ä¸­æ–‡: "å¦‚ä½•ä¼˜åŒ– React æ€§èƒ½"
æ—¥æ–‡: "React ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã™ã‚‹æ–¹æ³•"

// è¿™ä¸‰å¥è¯çš„å‘é‡éå¸¸ç›¸ä¼¼ï¼
ç›¸ä¼¼åº¦: 0.92
```

### 3. å¤„ç†é•¿å°¾æŸ¥è¯¢

```
ç”¨æˆ·æŸ¥è¯¢ï¼š"æˆ‘çš„ Next.js åº”ç”¨é¦–å±åŠ è½½æ…¢æ€ä¹ˆåŠï¼Ÿ"

å…³é”®è¯æœç´¢ï¼šå¾ˆéš¾åŒ¹é…ï¼ˆå¤ªé•¿ï¼Œå…³é”®è¯åˆ†æ•£ï¼‰
å‘é‡æœç´¢ï¼šå¯ä»¥ç†è§£æ•´ä½“è¯­ä¹‰ï¼Œæ‰¾åˆ°ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
```

### 4. RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

```
ä¼ ç»Ÿ LLM:
ç”¨æˆ·ï¼š"æˆ‘ä»¬å…¬å¸çš„è€ƒå‹¤åˆ¶åº¦æ˜¯ä»€ä¹ˆï¼Ÿ"
LLMï¼š"æˆ‘ä¸çŸ¥é“ä½ ä»¬å…¬å¸çš„å…·ä½“åˆ¶åº¦..."ï¼ˆå¹»è§‰ï¼‰

RAG + å‘é‡æœç´¢:
1. ä»å…¬å¸æ–‡æ¡£åº“æ£€ç´¢ç›¸å…³åˆ¶åº¦æ–‡ä»¶
2. å°†æ£€ç´¢ç»“æœä½œä¸ºä¸Šä¸‹æ–‡æä¾›ç»™ LLM
3. LLM åŸºäºçœŸå®æ–‡æ¡£ç”Ÿæˆå‡†ç¡®ç­”æ¡ˆ
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# 1. æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼ˆéœ€è¦ >= 16.0.0ï¼‰
node --version

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# 3. é…ç½® API Key
echo "OPENAI_API_KEY=sk-your-api-key-here" > .env
```

### 2. è¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹

```bash
# è¿è¡Œå‘é‡åŒ–åŸºç¡€ç¤ºä¾‹
npm run vector:embedding-basic
```

**é¢„æœŸè¾“å‡º**ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              å‘é‡åŒ–åŸºç¡€ç¤ºä¾‹ - Embedding æ¼”ç¤º                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ å¾…å‘é‡åŒ–çš„æ–‡æœ¬ï¼š
   1. LangChain æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ AI åº”ç”¨å¼€å‘æ¡†æ¶
   2. LangChain.js æ”¯æŒæ„å»ºå¤æ‚çš„ AI åº”ç”¨
   3. ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‡ºå»ç©
   4. React æ˜¯ä¸€ä¸ªå‰ç«¯æ¡†æ¶

ğŸ”„ æ­£åœ¨è¿›è¡Œå‘é‡åŒ–...
âœ… å‘é‡åŒ–å®Œæˆï¼
   - å‘é‡ç»´åº¦: 1536
   - å‘é‡æ•°é‡: 4

ğŸ“Š ç›¸ä¼¼åº¦çŸ©é˜µï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ï¼š

      æ–‡æœ¬1  æ–‡æœ¬2  æ–‡æœ¬3  æ–‡æœ¬4
      --------------------------------------------------
æ–‡æœ¬1: 1.000  0.894  0.125  0.234
æ–‡æœ¬2: 0.894  1.000  0.108  0.267
æ–‡æœ¬3: 0.125  0.108  1.000  0.156
æ–‡æœ¬4: 0.234  0.267  0.156  1.000

ğŸ’¡ ç›¸ä¼¼åº¦åˆ†æï¼š
   æ–‡æœ¬1 vs æ–‡æœ¬2 (éƒ½å…³äº LangChain): 0.8940 â­ æœ€ç›¸ä¼¼
   æ–‡æœ¬1 vs æ–‡æœ¬3 (ä¸ç›¸å…³):          0.1250 âŒ ä¸ç›¸ä¼¼
   æ–‡æœ¬1 vs æ–‡æœ¬4 (ç¨å¾®ç›¸å…³):        0.2340
```

### 3. è¿è¡Œå…¶ä»–ç¤ºä¾‹

```bash
# å‘é‡æœç´¢å®Œæ•´ç¤ºä¾‹
npm run vector:search

# æ··åˆæœç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
npm run vector:hybrid

# RAG é—®ç­”ç³»ç»Ÿ
npm run vector:rag-qa

# ä¼ä¸šæ–‡æ¡£æœç´¢ï¼ˆå®Œæ•´é¡¹ç›®ï¼‰
npm run vector:enterprise-search
```

---

## ğŸ” æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### 1. Embeddingï¼ˆå‘é‡åŒ–ï¼‰

**ä»€ä¹ˆæ˜¯ Embeddingï¼Ÿ**

Embedding æ˜¯å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å€¼å‘é‡çš„è¿‡ç¨‹ã€‚æ¯ä¸ªç»´åº¦ä»£è¡¨æ–‡æœ¬çš„æŸä¸ªç‰¹å¾ã€‚

```typescript
æ–‡æœ¬: "LangChain æ˜¯ä¸€ä¸ª AI æ¡†æ¶"

Embedding:
[
  0.234,   // ç»´åº¦ 0: å¯èƒ½è¡¨ç¤º"æŠ€æœ¯"çš„ç¨‹åº¦
  0.567,   // ç»´åº¦ 1: å¯èƒ½è¡¨ç¤º"æ¡†æ¶"çš„ç¨‹åº¦
  -0.123,  // ç»´åº¦ 2: å¯èƒ½è¡¨ç¤º"æƒ…æ„Ÿ"çš„ç¨‹åº¦
  ...      // å…± 1536 ç»´
  0.890
]
```

**å¸¸ç”¨çš„ Embedding æ¨¡å‹**ï¼š

| æ¨¡å‹ | ç»´åº¦ | æˆæœ¬ | ç‰¹ç‚¹ |
|-----|------|-----|------|
| text-embedding-3-small | 1536 | ä½ | æ€§ä»·æ¯”é«˜ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ |
| text-embedding-3-large | 3072 | ä¸­ | ç²¾åº¦æ›´é«˜ï¼Œé€‚åˆè¦æ±‚é«˜çš„åœºæ™¯ |
| text-embedding-ada-002 | 1536 | ä½ | æ—§ç‰ˆæ¨¡å‹ï¼Œä»ç„¶å¯ç”¨ |

### 2. ç›¸ä¼¼åº¦åº¦é‡

#### ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰

æœ€å¸¸ç”¨çš„åº¦é‡æ–¹å¼ï¼Œè¡¡é‡ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ï¼š

```
ä½™å¼¦ç›¸ä¼¼åº¦ = cos(Î¸) = (AÂ·B) / (||A|| Ã— ||B||)

èŒƒå›´: [-1, 1]
- 1: å®Œå…¨ç›¸åŒ
- 0: æ— å…³
- -1: å®Œå…¨ç›¸å
```

**ä»£ç å®ç°**ï¼š

```typescript
function cosineSimilarity(vecA: number[], vecB: number[]): number {
  let dotProduct = 0;
  let normA = 0;
  let normB = 0;

  for (let i = 0; i < vecA.length; i++) {
    dotProduct += vecA[i] * vecB[i];
    normA += vecA[i] * vecA[i];
    normB += vecB[i] * vecB[i];
  }

  return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
}
```

#### æ¬§æ°è·ç¦»ï¼ˆEuclidean Distance / L2ï¼‰

è¡¡é‡ä¸¤ä¸ªå‘é‡åœ¨ç©ºé—´ä¸­çš„ç›´çº¿è·ç¦»ï¼š

```
æ¬§æ°è·ç¦» = âˆš(Î£(Ai - Bi)Â²)

ç‰¹ç‚¹: è·ç¦»è¶Šå°è¶Šç›¸ä¼¼
```

#### ç‚¹ç§¯ï¼ˆDot Productï¼‰

```
ç‚¹ç§¯ = Î£(Ai Ã— Bi)

ç‰¹ç‚¹:
- è®¡ç®—å¿«
- éœ€è¦å‘é‡å½’ä¸€åŒ–
- é€‚åˆå·²å½’ä¸€åŒ–çš„å‘é‡
```

### 3. æ–‡æ¡£åˆ†å—ï¼ˆChunkingï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦åˆ†å—ï¼Ÿ**

- LLM æœ‰ Token é™åˆ¶ï¼ˆå¦‚ GPT-3.5 çš„ 4K ä¸Šä¸‹æ–‡ï¼‰
- é•¿æ–‡æ¡£åŒ…å«å¤šä¸ªä¸»é¢˜ï¼Œæ•´ä½“å‘é‡åŒ–ä¼šç¨€é‡Šè¯­ä¹‰
- å°å—æ›´ç²¾ç¡®ï¼Œå¤§å—æ›´å…¨é¢

**åˆ†å—ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|-----|----------|
| å›ºå®šé•¿åº¦ | å®ç°ç®€å• | å¯èƒ½ç ´åè¯­ä¹‰ | å‡åŒ€æ–‡æœ¬ |
| å¥å­/æ®µè½ | ä¿æŒè¯­ä¹‰å®Œæ•´ | é•¿åº¦ä¸å‡ | ç»“æ„åŒ–æ–‡æœ¬ |
| é‡å çª—å£ | é¿å…è¾¹ç•Œé—®é¢˜ | å­˜å‚¨å†—ä½™ | é€šç”¨åœºæ™¯ âœ… |

**æ¨èé…ç½®**ï¼š

```typescript
const chunkSize = 800;    // å—å¤§å°ï¼ˆå­—ç¬¦ï¼‰
const overlap = 100;      // é‡å å¤§å°ï¼ˆçº¦ 12.5%ï¼‰

// ä¸ºä»€ä¹ˆæ˜¯ 800ï¼Ÿ
// - çº¦ 200 tokensï¼ˆè‹±æ–‡ï¼‰
// - çº¦ 400 tokensï¼ˆä¸­æ–‡ï¼‰
// - æ—¢ä¿æŒè¯­ä¹‰å®Œæ•´ï¼Œåˆæ§åˆ¶æˆæœ¬
```

**ç¤ºä¾‹**ï¼š

```
åŸæ–‡æ¡£ï¼ˆ2000 å­—ç¬¦ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangChain æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ AI åº”ç”¨çš„æ¡†æ¶... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å—åï¼ˆ800 å­—ç¬¦ï¼Œé‡å  100ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å—1: 0-800       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å—2: 700-1500    â”‚ (é‡å  100)
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å—3: 1400-2000   â”‚ (é‡å  100)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æ£€ç´¢ç­–ç•¥

#### TopK æ£€ç´¢

æœ€åŸºç¡€çš„æ£€ç´¢æ–¹å¼ï¼Œè¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„ K ä¸ªæ–‡æ¡£ï¼š

```typescript
const results = await vectorStore.similaritySearch(query, 5);
// è¿”å›å‰ 5 ä¸ªæœ€ç›¸ä¼¼çš„æ–‡æ¡£
```

#### MMRï¼ˆæœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼‰

åœ¨ç›¸å…³æ€§å’Œå¤šæ ·æ€§ä¹‹é—´å¹³è¡¡ï¼š

```
MMR = Î» Ã— Relevance - (1-Î») Ã— Similarity_to_selected

Î» = 0: å®Œå…¨è¿½æ±‚å¤šæ ·æ€§
Î» = 1: å®Œå…¨è¿½æ±‚ç›¸å…³æ€§
Î» = 0.5: å¹³è¡¡ï¼ˆæ¨èï¼‰
```

**ä¸ºä»€ä¹ˆéœ€è¦ MMRï¼Ÿ**

```
æŸ¥è¯¢: "React æ€§èƒ½ä¼˜åŒ–"

TopK ç»“æœï¼ˆå¯èƒ½å¾ˆé‡å¤ï¼‰:
1. React.memo ä½¿ç”¨æŒ‡å—
2. React.memo æœ€ä½³å®è·µ
3. React.memo å¸¸è§é—®é¢˜
4. React.memo è¿›é˜¶æŠ€å·§
5. React.memo æ€§èƒ½å¯¹æ¯”

MMR ç»“æœï¼ˆæ›´å¤šæ ·åŒ–ï¼‰:
1. React.memo ä½¿ç”¨æŒ‡å—
2. useMemo å’Œ useCallback
3. è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–
4. Code Splitting
5. å›¾ç‰‡æ‡’åŠ è½½
```

#### æ··åˆæœç´¢

ç»“åˆå‘é‡æœç´¢å’Œå…³é”®è¯æœç´¢ï¼ˆBM25ï¼‰ï¼š

```typescript
// å‘é‡æœç´¢ï¼šç†è§£è¯­ä¹‰
vectorResults = vectorSearch("æ€§èƒ½ä¼˜åŒ–", k=10)

// å…³é”®è¯æœç´¢ï¼šç²¾ç¡®åŒ¹é…
keywordResults = bm25Search("æ€§èƒ½ä¼˜åŒ–", k=10)

// èåˆç»“æœ
finalResults = merge(vectorResults, keywordResults, weights=[0.7, 0.3])
```

**æƒé‡å»ºè®®**ï¼š

| åœºæ™¯ | å‘é‡æƒé‡ | å…³é”®è¯æƒé‡ | åŸå›  |
|-----|---------|-----------|------|
| æŠ€æœ¯æ–‡æ¡£ | 0.7 | 0.3 | è¯­ä¹‰ç†è§£æ›´é‡è¦ |
| æ–°é—»èµ„è®¯ | 0.5 | 0.5 | ä¸¤è€…åŒç­‰é‡è¦ |
| ä»£ç æœç´¢ | 0.4 | 0.6 | ç²¾ç¡®åŒ¹é…æ›´é‡è¦ |
| æ³•å¾‹æ–‡æœ¬ | 0.3 | 0.7 | ç²¾ç¡®ç”¨è¯å¾ˆå…³é”® |

---

## ğŸ’» ä»£ç ç¤ºä¾‹è¯¦è§£

### æ¡ˆä¾‹ 1ï¼šå‘é‡åŒ–åŸºç¡€

**æ–‡ä»¶**ï¼š[embedding-basic.ts](./embedding-basic.ts)

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
import { OpenAIEmbeddings } from "@langchain/openai";

// 1. åˆ›å»º Embeddings å®ä¾‹
const embeddings = new OpenAIEmbeddings({
  modelName: "text-embedding-3-small",
});

// 2. å•ä¸ªæ–‡æœ¬å‘é‡åŒ–
const singleVector = await embeddings.embedQuery("Hello, world!");
console.log(singleVector.length); // 1536

// 3. æ‰¹é‡å‘é‡åŒ–ï¼ˆæ›´é«˜æ•ˆï¼‰
const texts = ["æ–‡æœ¬1", "æ–‡æœ¬2", "æ–‡æœ¬3"];
const vectors = await embeddings.embedDocuments(texts);
console.log(vectors.length); // 3

// 4. è®¡ç®—ç›¸ä¼¼åº¦
function cosineSimilarity(a: number[], b: number[]): number {
  let dot = 0, normA = 0, normB = 0;
  for (let i = 0; i < a.length; i++) {
    dot += a[i] * b[i];
    normA += a[i] * a[i];
    normB += b[i] * b[i];
  }
  return dot / (Math.sqrt(normA) * Math.sqrt(normB));
}

const sim = cosineSimilarity(vectors[0], vectors[1]);
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
npm run vector:embedding-basic
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… å¦‚ä½•ä½¿ç”¨ OpenAI Embeddings
- âœ… æ‰¹é‡å¤„ç†æå‡æ€§èƒ½ï¼ˆä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ–‡æœ¬ï¼‰
- âœ… ç›¸ä¼¼åº¦è®¡ç®—çš„å®ç°
- âœ… å‘é‡ç»´åº¦å’Œç²¾åº¦çš„å…³ç³»

---

### æ¡ˆä¾‹ 2ï¼šæ–‡æ¡£åŠ è½½å’Œåˆ†å—

**æ–‡ä»¶**ï¼š[loaders.ts](./loaders.ts) + [chunk.ts](./chunk.ts)

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
// 1. åŠ è½½ Markdown æ–‡æ¡£
import { loadMarkdownDir } from "./loaders";

const docs = await loadMarkdownDir("./docs");
// è¿”å›: [{ id, text, meta }]

// 2. æ–‡æœ¬æ¸…æ´—
import { clean } from "./chunk";

const cleaned = clean(rawText);
// - ç»Ÿä¸€æ¢è¡Œç¬¦
// - å»é™¤å¤šä½™ç©ºç™½
// - è§„èŒƒåŒ–æ ¼å¼

// 3. æ–‡æ¡£åˆ†å—
import { makeChunks } from "./chunk";

const chunks = makeChunks(docs, 800, 100);
// chunkSize: 800 å­—ç¬¦
// overlap: 100 å­—ç¬¦é‡å 
```

**åˆ†å—ç­–ç•¥å¯è§†åŒ–**ï¼š

```
åŸæ–‡æ¡£ï¼ˆ2400 å­—ç¬¦ï¼‰:
[===============================]

åˆ†å—ï¼ˆ800, overlap=100ï¼‰:
[========]
       [========]
              [========]

å—1: å­—ç¬¦ 0-800
å—2: å­—ç¬¦ 700-1500  (ä¸å—1é‡å 100)
å—3: å­—ç¬¦ 1400-2200 (ä¸å—2é‡å 100)
å—4: å­—ç¬¦ 2100-2400 (ä¸å—3é‡å 100)
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… å¦‚ä½•åŠ è½½ä¸åŒæ ¼å¼çš„æ–‡æ¡£
- âœ… æ–‡æœ¬æ¸…æ´—çš„é‡è¦æ€§
- âœ… åˆ†å—å¤§å°å’Œé‡å çš„æƒè¡¡
- âœ… ä¿æŒè¯­ä¹‰å®Œæ•´æ€§

---

### æ¡ˆä¾‹ 3ï¼šå‘é‡æœç´¢

**æ–‡ä»¶**ï¼š[vector-search.ts](./vector-search.ts)

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
import { SimpleVectorStore } from "./simple-vector-store";

// 1. åˆ›å»ºå‘é‡å­˜å‚¨
const vectorStore = new SimpleVectorStore();

// 2. æ·»åŠ æ–‡æ¡£
await vectorStore.addDocuments(chunks);

// 3. ç›¸ä¼¼åº¦æœç´¢
const results = await vectorStore.similaritySearch(
  "LangChain å¦‚ä½•ä½¿ç”¨ï¼Ÿ",
  5  // è¿”å›å‰5ä¸ª
);

// 4. å¸¦è¿‡æ»¤çš„æœç´¢
const filteredResults = await vectorStore.similaritySearchWithFilter(
  "æ€§èƒ½ä¼˜åŒ–",
  5,
  (meta) => meta.type === "tutorial"  // åªæœç´¢æ•™ç¨‹ç±»å‹
);

// 5. MMR æœç´¢ï¼ˆå¤šæ ·æ€§ï¼‰
const mmrResults = await vectorStore.maxMarginalRelevanceSearch(
  "React ä¼˜åŒ–",
  5,
  0.5  // lambda: å¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§
);
```

**æœç´¢ç»“æœç¤ºä¾‹**ï¼š

```
æŸ¥è¯¢: "å¦‚ä½•ä¼˜åŒ– React æ€§èƒ½ï¼Ÿ"

ç»“æœ:
1. [0.9234] React.memo ä½¿ç”¨æŒ‡å—
   æ¥æº: react-optimization.md#2
   å†…å®¹: React.memo æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç”¨äºé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“...

2. [0.8756] useMemo å’Œ useCallback è¯¦è§£
   æ¥æº: react-hooks.md#5
   å†…å®¹: useMemo ç”¨äºç¼“å­˜è®¡ç®—ç»“æœï¼ŒuseCallback ç”¨äºç¼“å­˜å‡½æ•°...

3. [0.8432] è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–é•¿åˆ—è¡¨æ¸²æŸ“
   æ¥æº: react-performance.md#3
   å†…å®¹: å½“åˆ—è¡¨åŒ…å«æˆåƒä¸Šä¸‡æ¡æ•°æ®æ—¶ï¼Œæ¸²æŸ“æ‰€æœ‰å…ƒç´ ä¼šå¯¼è‡´...
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
npm run vector:search
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… å‘é‡å­˜å‚¨çš„ä½¿ç”¨
- âœ… ç›¸ä¼¼åº¦æœç´¢çš„å®ç°
- âœ… å…ƒæ•°æ®è¿‡æ»¤çš„åº”ç”¨
- âœ… MMR æœç´¢æå‡å¤šæ ·æ€§

---

### æ¡ˆä¾‹ 4ï¼šæ··åˆæœç´¢

**æ–‡ä»¶**ï¼š[hybrid-search.ts](./hybrid-search.ts)

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
import { HybridSearchEngine } from "./hybrid-search";

// 1. åˆ›å»ºæ··åˆæœç´¢å¼•æ“
const engine = new HybridSearchEngine();
await engine.addDocuments(chunks);

// 2. æ··åˆæœç´¢
const results = await engine.hybridSearch(
  "LangChain å‘é‡æ•°æ®åº“",
  5,         // topK
  0.6        // å‘é‡æƒé‡ï¼ˆ0.6å‘é‡ + 0.4å…³é”®è¯ï¼‰
);

// 3. ç»“æœåŒ…å«æ¥æºæ ‡è¯†
results.forEach(result => {
  console.log(result.source); // "vector", "keyword", æˆ– "vector+keyword"
  console.log(result.score);  // èåˆåçš„åˆ†æ•°
});
```

**æ··åˆæœç´¢ä¼˜åŠ¿**ï¼š

```
æŸ¥è¯¢: "Chroma Pinecone"

çº¯å‘é‡æœç´¢:
âœ“ ç†è§£"å‘é‡æ•°æ®åº“"çš„è¯­ä¹‰
âœ— å¯èƒ½é”™è¿‡ç²¾ç¡®çš„äº§å“åç§°

çº¯å…³é”®è¯æœç´¢:
âœ“ ç²¾ç¡®åŒ¹é…"Chroma"å’Œ"Pinecone"
âœ— æ— æ³•ç†è§£è¯­ä¹‰ç›¸å…³çš„å†…å®¹

æ··åˆæœç´¢:
âœ“ ç²¾ç¡®åŒ¹é…äº§å“åç§°ï¼ˆå…³é”®è¯ï¼‰
âœ“ ç†è§£å‘é‡æ•°æ®åº“çš„è¯­ä¹‰ï¼ˆå‘é‡ï¼‰
â†’ æœ€ä½³ç»“æœï¼
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
npm run vector:hybrid
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… å‘é‡æœç´¢ vs å…³é”®è¯æœç´¢
- âœ… ç»“æœèåˆç­–ç•¥
- âœ… æƒé‡è°ƒæ•´çš„å½±å“
- âœ… ä¸åŒåœºæ™¯çš„æœ€ä½³æƒé‡

---

### æ¡ˆä¾‹ 5ï¼šRAG é—®ç­”ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š[rag-qa.ts](./rag-qa.ts)

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
import { RAGQuestionAnswering } from "./rag-qa";

// 1. åˆ›å»º RAG å¼•æ“
const rag = new RAGQuestionAnswering();

// 2. æ·»åŠ çŸ¥è¯†åº“
await rag.addDocuments(knowledgeBaseChunks);

// 3. æé—®
const result = await rag.ask("LangChain æœ‰å“ªäº›æ ¸å¿ƒæ¨¡å—ï¼Ÿ", 5);

console.log(result.answer);   // AI ç”Ÿæˆçš„ç­”æ¡ˆ
console.log(result.sources);  // ç­”æ¡ˆçš„æ¥æºæ–‡æ¡£
```

**RAG å·¥ä½œæµç¨‹**ï¼š

```
ç”¨æˆ·æé—®
   â†“
ã€æ­¥éª¤1ï¼šæ£€ç´¢ã€‘
   å‘é‡æœç´¢ â†’ æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ç‰‡æ®µ
   â†“
ã€æ­¥éª¤2ï¼šä¸Šä¸‹æ–‡ç»„è£…ã€‘
   å°†ç‰‡æ®µç»„è£…æˆä¸Šä¸‹æ–‡
   â†“
ã€æ­¥éª¤3ï¼šç”Ÿæˆç­”æ¡ˆã€‘
   LLM + Prompt + ä¸Šä¸‹æ–‡ â†’ ç”Ÿæˆç­”æ¡ˆ
   â†“
ã€æ­¥éª¤4ï¼šè¿”å›ç»“æœã€‘
   ç­”æ¡ˆ + æ¥æºå¼•ç”¨
```

**Prompt æ¨¡æ¿**ï¼š

```typescript
const prompt = `ä½ æ˜¯ä¸“ä¸šçš„æŠ€æœ¯åŠ©æ‰‹ã€‚è¯·ä¸¥æ ¼åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ã€‚

è§„åˆ™ï¼š
1. åªä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯å›ç­”
2. å¦‚æœä¸Šä¸‹æ–‡ä¸åŒ…å«ç­”æ¡ˆï¼Œæ˜ç¡®è¯´æ˜"æ ¹æ®æä¾›çš„ä¿¡æ¯æ— æ³•å›ç­”è¯¥é—®é¢˜"
3. å›ç­”è¦å‡†ç¡®ã€ç®€æ´ã€æœ‰æ¡ç†
4. å¦‚æœå¯èƒ½ï¼Œå¼•ç”¨åŸæ–‡ç‰‡æ®µ

ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š
{context}

é—®é¢˜ï¼š{question}

è¯·å›ç­”ï¼š`;
```

**ç¤ºä¾‹å¯¹è¯**ï¼š

```
â“ é—®é¢˜: LangChain æœ‰å“ªäº›æ ¸å¿ƒæ¨¡å—ï¼Ÿ

ğŸ’¡ ç­”æ¡ˆ:
æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒLangChain åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

1. Modelsï¼ˆæ¨¡å‹å±‚ï¼‰- æ”¯æŒå¤šç§ LLM æä¾›å•†
2. Promptsï¼ˆæç¤ºè¯å±‚ï¼‰- æç¤ºè¯æ¨¡æ¿ç®¡ç†
3. Chainsï¼ˆé“¾å±‚ï¼‰- é“¾å¼è°ƒç”¨ç¼–æ’
4. Memoryï¼ˆè®°å¿†å±‚ï¼‰- å¯¹è¯è®°å¿†ç³»ç»Ÿ
5. Agentsï¼ˆä»£ç†å±‚ï¼‰- æ™ºèƒ½ä»£ç†å’Œå·¥å…·è°ƒç”¨

ğŸ“ å‚è€ƒæ¥æº:
   1. langchain-intro.md#kb-0#0
   2. langchain-intro.md#kb-0#1
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
npm run vector:rag-qa
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… RAG çš„å®Œæ•´æµç¨‹
- âœ… ä¸Šä¸‹æ–‡ç»„è£…ç­–ç•¥
- âœ… Prompt å·¥ç¨‹æŠ€å·§
- âœ… æ¥æºè¿½æº¯çš„é‡è¦æ€§

---

## ğŸ¯ å®æˆ˜é¡¹ç›®

### ä¼ä¸šæ–‡æ¡£æœç´¢ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š[enterprise-search/search-engine.ts](./enterprise-search/search-engine.ts)

**åŠŸèƒ½ç‰¹æ€§**ï¼š

```
âœ… å¤šæºæ–‡æ¡£åŠ è½½ï¼ˆMarkdownã€PDFã€æ–‡æœ¬ï¼‰
âœ… æ™ºèƒ½åˆ†å—å¤„ç†
âœ… æ··åˆæœç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰
âœ… RAG é—®ç­”
âœ… å…ƒæ•°æ®è¿‡æ»¤
âœ… ç»“æœé«˜äº®
âœ… é”™è¯¯å¤„ç†å’Œé™çº§
âœ… æ€§èƒ½ç›‘æ§
```

**æ ¸å¿ƒæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¼ä¸šæ–‡æ¡£æœç´¢ç³»ç»Ÿ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ æ–‡æ¡£åŠ è½½å™¨   â”‚  â”‚  åˆ†å—å¤„ç†    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                  â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚  å‘é‡åŒ–å­˜å‚¨     â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                  â”‚                          â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚      â†“                       â†“              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ å‘é‡æœç´¢  â”‚          â”‚ å…³é”®è¯æœç´¢â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                     â”‚               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚   ç»“æœèåˆ      â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                  â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚   RAG é—®ç­”      â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```typescript
import { EnterpriseSearchEngine } from "./enterprise-search/search-engine";

// 1. åˆå§‹åŒ–
const engine = new EnterpriseSearchEngine();
await engine.initialize("./docs");

// 2. æœç´¢æ–‡æ¡£
const searchResults = await engine.search("React æ€§èƒ½ä¼˜åŒ–", {
  k: 5,
  vectorWeight: 0.6,
  highlight: true,
});

searchResults.forEach(result => {
  console.log(`æ ‡é¢˜: ${result.title}`);
  console.log(`ç›¸ä¼¼åº¦: ${result.score}`);
  console.log(`æ¥æº: ${result.source}`);
  console.log(`å†…å®¹: ${result.content}`);
  console.log(`é«˜äº®: ${result.highlight}`);
});

// 3. æ™ºèƒ½é—®ç­”
const qaResult = await engine.ask("å¦‚ä½•é€‰æ‹©å‘é‡æ•°æ®åº“ï¼Ÿ", 5);

console.log(`ç­”æ¡ˆ: ${qaResult.answer}`);
console.log(`ç½®ä¿¡åº¦: ${qaResult.confidence}`);
console.log(`æ¥æº:`, qaResult.sources);
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
npm run vector:enterprise-search
```

**é¢„æœŸè¾“å‡º**ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ä¼ä¸šæ–‡æ¡£æœç´¢ç³»ç»Ÿ - å®Œæ•´å®æˆ˜é¡¹ç›®                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ åˆå§‹åŒ–ä¼ä¸šæ–‡æ¡£æœç´¢å¼•æ“...

âœ… æˆåŠŸåŠ è½½ 3 ä¸ª Markdown æ–‡æ¡£
âœ‚ï¸  æ–‡æ¡£åˆ†å—å®Œæˆ: 12 ä¸ªå—
âœ… æœç´¢å¼•æ“åˆå§‹åŒ–å®Œæˆ

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
   - æ–‡æ¡£æ•°: 3
   - å—æ•°: 12
   - ç´¢å¼•å¤§å°: 12

================================================================
ğŸ” åŠŸèƒ½æµ‹è¯• 1: æ–‡æ¡£æœç´¢
================================================================

ğŸ“Œ æŸ¥è¯¢: "LangChain æœ‰å“ªäº›æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ"

æ‰¾åˆ° 3 ä¸ªç›¸å…³æ–‡æ¡£:

1. [vector+keyword] LangChain.js å…¥é—¨æ•™ç¨‹
   ç›¸ä¼¼åº¦: 0.8756
   å†…å®¹: LangChain.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œç”¨äºæ„å»ºåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åº”ç”¨ç¨‹åº...
   é«˜äº®: ã€LangChainã€‘.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œç”¨äºæ„å»ºåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åº”ç”¨ç¨‹åº...

[æ›´å¤šç»“æœ...]

================================================================
ğŸ’¬ åŠŸèƒ½æµ‹è¯• 2: æ™ºèƒ½é—®ç­”
================================================================

â“ é—®é¢˜: LangChain.js å¦‚ä½•å®‰è£…ï¼Ÿ

ğŸ’¡ ç­”æ¡ˆ:
æ ¹æ®æ–‡æ¡£ï¼ŒLangChain.js çš„å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š

```bash
npm install @langchain/core @langchain/openai
```

å®‰è£…åå³å¯å¼€å§‹ä½¿ç”¨ LangChain.js æ„å»º AI åº”ç”¨ã€‚

ğŸ“Š ç½®ä¿¡åº¦: é«˜

ğŸ“ å‚è€ƒæ¥æº:
   1. LangChain.js å…¥é—¨æ•™ç¨‹ (doc-0#1)

âœ… ä¼ä¸šæ–‡æ¡£æœç´¢ç³»ç»Ÿæµ‹è¯•å®Œæˆï¼

ğŸ’¡ ç³»ç»Ÿç‰¹ç‚¹ï¼š
   âœ“ æ··åˆæœç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰
   âœ“ RAG é—®ç­”
   âœ“ ç»“æœé«˜äº®
   âœ“ é”™è¯¯å¤„ç†
   âœ“ é™çº§ç­–ç•¥
```

**å­¦ä¹ è¦ç‚¹**ï¼š

- âœ… å®Œæ•´çš„ä¼ä¸šçº§æœç´¢ç³»ç»Ÿæ¶æ„
- âœ… æ··åˆæœç´¢çš„å®é™…åº”ç”¨
- âœ… RAG é—®ç­”çš„å®Œæ•´å®ç°
- âœ… é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
- âœ… ç»“æœé«˜äº®å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ Embedding æ¨¡å‹ï¼Ÿ

**å†³ç­–æ ‘**ï¼š

```
æˆæœ¬æ•æ„Ÿï¼Ÿ
  â”œâ”€ æ˜¯ â†’ text-embedding-3-small (1536ç»´)
  â””â”€ å¦ â†’ ç»§ç»­

ç²¾åº¦è¦æ±‚é«˜ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ text-embedding-3-large (3072ç»´)
  â””â”€ å¦ â†’ text-embedding-3-small
```

**å¯¹æ¯”è¡¨**ï¼š

| æ¨¡å‹ | ç»´åº¦ | æˆæœ¬/1M tokens | ç²¾åº¦ | æ¨èåœºæ™¯ |
|-----|------|---------------|------|---------|
| text-embedding-3-small | 1536 | $0.02 | â˜…â˜…â˜…â˜…â˜† | é€šç”¨åœºæ™¯ âœ… |
| text-embedding-3-large | 3072 | $0.13 | â˜…â˜…â˜…â˜…â˜… | é«˜ç²¾åº¦éœ€æ±‚ |
| ada-002 | 1536 | $0.10 | â˜…â˜…â˜…â˜†â˜† | æ—§ç‰ˆï¼Œä¸æ¨è |

### Q2: åˆ†å—å¤§å°å¦‚ä½•è®¾ç½®ï¼Ÿ

**ç»éªŒæ³•åˆ™**ï¼š

```typescript
// ä¸­æ–‡æ–‡æ¡£
const chunkSize = 800;    // çº¦ 400 tokens
const overlap = 100;      // çº¦ 50 tokens

// è‹±æ–‡æ–‡æ¡£
const chunkSize = 1000;   // çº¦ 250 tokens
const overlap = 150;      // çº¦ 35 tokens

// ä»£ç æ–‡æ¡£
const chunkSize = 600;    // çº¦ 150 tokensï¼ˆä¿æŒå‡½æ•°å®Œæ•´ï¼‰
const overlap = 50;
```

**å¯¹æ¯”å®éªŒ**ï¼š

| å—å¤§å° | Token æˆæœ¬ | å¬å›ç‡ | å‡†ç¡®ç‡ | æ¨èæŒ‡æ•° |
|-------|-----------|--------|--------|---------|
| 400 å­—ç¬¦ | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜†â˜†â˜† | â˜…â˜…â˜†â˜†â˜† | ä¸æ¨è |
| 800 å­—ç¬¦ | â˜…â˜…â˜…â˜…â˜† | â˜…â˜…â˜…â˜…â˜† | â˜…â˜…â˜…â˜…â˜† | âœ… æ¨è |
| 1200 å­—ç¬¦ | â˜…â˜…â˜…â˜†â˜† | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜…â˜… | é€‚åˆé•¿æ–‡ |
| 2000 å­—ç¬¦ | â˜…â˜…â˜†â˜†â˜† | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜†â˜† | ä¸æ¨è |

### Q3: å‘é‡æœç´¢ vs å…³é”®è¯æœç´¢ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ

**åœºæ™¯å¯¹æ¯”**ï¼š

```
åœºæ™¯ 1ï¼šç²¾ç¡®åŒ¹é…
æŸ¥è¯¢: "iPhone 14 Pro Max"
æœ€ä½³: å…³é”®è¯æœç´¢ï¼ˆç²¾ç¡®åŒ¹é…äº§å“åï¼‰

åœºæ™¯ 2ï¼šè¯­ä¹‰ç†è§£
æŸ¥è¯¢: "å¦‚ä½•è®©ç½‘ç«™åŠ è½½æ›´å¿«ï¼Ÿ"
æœ€ä½³: å‘é‡æœç´¢ï¼ˆç†è§£ä¼˜åŒ–çš„è¯­ä¹‰ï¼‰

åœºæ™¯ 3ï¼šæ··åˆåœºæ™¯
æŸ¥è¯¢: "React æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"
æœ€ä½³: æ··åˆæœç´¢ï¼ˆç²¾ç¡®åŒ¹é…+è¯­ä¹‰ç†è§£ï¼‰
```

**å»ºè®®**ï¼š

- ğŸ“± ç”µå•†/äº§å“æœç´¢ï¼šå…³é”®è¯æƒé‡ 0.6-0.7
- ğŸ“š æŠ€æœ¯æ–‡æ¡£æœç´¢ï¼šå‘é‡æƒé‡ 0.6-0.7
- ğŸ“° æ–°é—»/åšå®¢æœç´¢ï¼šå¹³è¡¡ 0.5-0.5
- ğŸ’¼ ä¼ä¸šçŸ¥è¯†åº“ï¼šå‘é‡æƒé‡ 0.7-0.8

### Q4: å¦‚ä½•è¯„ä¼°æœç´¢è´¨é‡ï¼Ÿ

**å…³é”®æŒ‡æ ‡**ï¼š

1. **å¬å›ç‡ï¼ˆRecallï¼‰**
   ```
   å¬å›ç‡ = æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£æ•° / æ€»ç›¸å…³æ–‡æ¡£æ•°

   ç›®æ ‡: > 80%
   ```

2. **å‡†ç¡®ç‡ï¼ˆPrecisionï¼‰**
   ```
   å‡†ç¡®ç‡ = è¿”å›ç»“æœä¸­ç›¸å…³æ–‡æ¡£æ•° / è¿”å›çš„æ€»æ–‡æ¡£æ•°

   ç›®æ ‡: > 70%
   ```

3. **MRRï¼ˆMean Reciprocal Rankï¼‰**
   ```
   MRR = 1/N Ã— Î£(1 / é¦–ä¸ªç›¸å…³ç»“æœçš„æ’å)

   ç›®æ ‡: > 0.5
   ```

**è¯„ä¼°æ–¹æ³•**ï¼š

```typescript
// 1. å‡†å¤‡æµ‹è¯•é›†
const testCases = [
  {
    query: "React æ€§èƒ½ä¼˜åŒ–",
    relevantDocs: ["doc-1", "doc-3", "doc-7"],
  },
  // ... æ›´å¤šæµ‹è¯•ç”¨ä¾‹
];

// 2. è¿è¡Œè¯„ä¼°
for (const test of testCases) {
  const results = await search(test.query, 10);
  const retrieved = results.map(r => r.id);

  const recall = calculateRecall(retrieved, test.relevantDocs);
  const precision = calculatePrecision(retrieved, test.relevantDocs);

  console.log(`Recall: ${recall}, Precision: ${precision}`);
}
```

### Q5: å¦‚ä½•å¤„ç†å¤šè¯­è¨€æœç´¢ï¼Ÿ

**æ–¹æ¡ˆ 1ï¼šä½¿ç”¨å¤šè¯­è¨€ Embedding æ¨¡å‹**

```typescript
// OpenAI çš„æ¨¡å‹åŸç”Ÿæ”¯æŒå¤šè¯­è¨€
const embeddings = new OpenAIEmbeddings({
  modelName: "text-embedding-3-small",
});

// è¿™äº›æŸ¥è¯¢ä¼šæ˜ å°„åˆ°ç›¸ä¼¼çš„å‘é‡ç©ºé—´
const queries = [
  "How to optimize React?",
  "å¦‚ä½•ä¼˜åŒ– Reactï¼Ÿ",
  "React ã®æœ€é©åŒ–æ–¹æ³•",
];
```

**æ–¹æ¡ˆ 2ï¼šåˆ†è¯­è¨€å»ºç«‹ç´¢å¼•**

```typescript
// ä¸­æ–‡ç´¢å¼•
const zhStore = new VectorStore("zh");
await zhStore.addDocuments(chineseChunks);

// è‹±æ–‡ç´¢å¼•
const enStore = new VectorStore("en");
await enStore.addDocuments(englishChunks);

// æ£€æµ‹æŸ¥è¯¢è¯­è¨€å¹¶è·¯ç”±
const lang = detectLanguage(query);
const store = lang === "zh" ? zhStore : enStore;
const results = await store.search(query);
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ–‡æ¡£å¤„ç†æœ€ä½³å®è·µ

**æ¸…æ´—æµç¨‹**ï¼š

```typescript
function processDocument(raw: string): string {
  return raw
    // 1. ç§»é™¤ Markdown è¯­æ³•ï¼ˆå¯é€‰ï¼‰
    .replace(/#+\s/g, "")          // æ ‡é¢˜
    .replace(/\*\*([^*]+)\*\*/g, "$1")  // ç²—ä½“
    .replace(/\*([^*]+)\*/g, "$1")      // æ–œä½“

    // 2. æ¸…ç†ç©ºç™½
    .replace(/\r/g, "\n")
    .replace(/\n{3,}/g, "\n\n")
    .replace(/\s+/g, " ")

    // 3. ç§»é™¤ç‰¹æ®Šå­—ç¬¦
    .replace(/[^\w\s\u4e00-\u9fa5.,!?;:()]/g, "")

    .trim();
}
```

**å…ƒæ•°æ®ç®¡ç†**ï¼š

```typescript
const chunk = {
  id: "doc-1#chunk-3",
  text: "...",
  meta: {
    // åŸºç¡€ä¿¡æ¯
    source: "react-optimization.md",
    fileName: "react-optimization.md",
    fileType: "markdown",

    // åˆ†å—ä¿¡æ¯
    chunkIndex: 3,
    totalChunks: 10,

    // ä¸šåŠ¡ä¿¡æ¯
    author: "å¼ ä¸‰",
    department: "æŠ€æœ¯éƒ¨",
    tags: ["React", "æ€§èƒ½ä¼˜åŒ–"],
    createdAt: "2024-01-01",

    // è®¿é—®æ§åˆ¶
    visibility: "internal",
    accessLevel: 2,
  },
};
```

### 2. æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

**æ‰¹é‡å¤„ç†**ï¼š

```typescript
// âŒ é€ä¸ªå¤„ç†ï¼ˆæ…¢ï¼‰
for (const text of texts) {
  const vector = await embeddings.embedQuery(text);
  await vectorStore.add(vector, text);
}

// âœ… æ‰¹é‡å¤„ç†ï¼ˆå¿« 10-50 å€ï¼‰
const vectors = await embeddings.embedDocuments(texts);
await vectorStore.addVectors(vectors, texts);
```

**ç¼“å­˜ç­–ç•¥**ï¼š

```typescript
class CachedEmbeddings {
  private cache = new Map<string, number[]>();

  async embed(text: string): Promise<number[]> {
    // ä½¿ç”¨æ–‡æœ¬ hash ä½œä¸º key
    const key = this.hash(text);

    if (this.cache.has(key)) {
      return this.cache.get(key)!;
    }

    const vector = await this.embeddings.embedQuery(text);
    this.cache.set(key, vector);
    return vector;
  }

  private hash(text: string): string {
    // ç®€å•çš„ hash å®ç°
    return require("crypto")
      .createHash("md5")
      .update(text)
      .digest("hex");
  }
}
```

**è¿æ¥æ± **ï¼š

```typescript
import { Pool } from "pg";

// æ•°æ®åº“è¿æ¥æ± 
const pool = new Pool({
  max: 20,              // æœ€å¤§è¿æ¥æ•°
  min: 5,               // æœ€å°è¿æ¥æ•°
  idleTimeoutMillis: 30000,
});

// ä½¿ç”¨è¿æ¥æ± 
async function query(sql: string) {
  const client = await pool.connect();
  try {
    const result = await client.query(sql);
    return result;
  } finally {
    client.release();  // é‡Šæ”¾è¿æ¥å›æ± 
  }
}
```

### 3. ç›‘æ§å’Œå‘Šè­¦

**å…³é”®æŒ‡æ ‡**ï¼š

```typescript
class SearchMetrics {
  // 1. QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰
  private qpsCounter = 0;

  trackQuery() {
    this.qpsCounter++;
  }

  // 2. å»¶è¿Ÿï¼ˆP50/P95/P99ï¼‰
  private latencies: number[] = [];

  trackLatency(ms: number) {
    this.latencies.push(ms);
  }

  getP95(): number {
    const sorted = this.latencies.sort((a, b) => a - b);
    const index = Math.floor(sorted.length * 0.95);
    return sorted[index];
  }

  // 3. é”™è¯¯ç‡
  private errorCount = 0;
  private totalCount = 0;

  trackError() {
    this.errorCount++;
    this.totalCount++;
  }

  getErrorRate(): number {
    return this.errorCount / this.totalCount;
  }

  // 4. Token æ¶ˆè€—
  private tokenUsage = 0;

  trackTokens(count: number) {
    this.tokenUsage += count;
  }
}
```

**å‘Šè­¦è§„åˆ™**ï¼š

```typescript
// æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
setInterval(() => {
  // 1. å“åº”æ—¶é—´å‘Šè­¦
  if (metrics.getP95() > 2000) {
    alert("P95 å»¶è¿Ÿè¶…è¿‡ 2s");
  }

  // 2. é”™è¯¯ç‡å‘Šè­¦
  if (metrics.getErrorRate() > 0.01) {
    alert("é”™è¯¯ç‡è¶…è¿‡ 1%");
  }

  // 3. Token æ¶ˆè€—å‘Šè­¦
  if (metrics.tokenUsage > dailyBudget) {
    alert("Token æ¶ˆè€—è¶…è¿‡é¢„ç®—");
  }
}, 60000);
```

### 4. å®‰å…¨æ€§æœ€ä½³å®è·µ

**æ•°æ®éš”ç¦»**ï¼š

```typescript
// å¤šç§Ÿæˆ·éš”ç¦»
const sessionKey = `tenant:${tenantId}:user:${userId}:session:${sessionId}`;

// æƒé™æ£€æŸ¥
function checkAccess(userId: string, documentId: string): boolean {
  const doc = getDocument(documentId);

  // æ£€æŸ¥è®¿é—®çº§åˆ«
  const userLevel = getUserAccessLevel(userId);
  const docLevel = doc.meta.accessLevel;

  return userLevel >= docLevel;
}

// è¿‡æ»¤æœç´¢ç»“æœ
async function search(query: string, userId: string) {
  const rawResults = await vectorStore.search(query);

  // åªè¿”å›ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„ç»“æœ
  return rawResults.filter(result =>
    checkAccess(userId, result.id)
  );
}
```

**æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**ï¼š

```typescript
function filterSensitiveInfo(text: string): string {
  return text
    .replace(/\d{11}/g, "***********")           // æ‰‹æœºå·
    .replace(/\d{15,18}/g, "******************") // èº«ä»½è¯
    .replace(/\d{16}/g, "****************")      // é“¶è¡Œå¡
    .replace(/\b[\w.-]+@[\w.-]+\.\w+\b/g, "***@***.***"); // é‚®ç®±
}
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [LangChain.js å®˜æ–¹æ–‡æ¡£](https://js.langchain.com/)
- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)
- [Vector Database Guide](https://www.pinecone.io/learn/vector-database/)

### å‘é‡æ•°æ®åº“

- [Chroma](https://docs.trychroma.com/) - è½»é‡çº§å‘é‡æ•°æ®åº“
- [Pinecone](https://docs.pinecone.io/) - æ‰˜ç®¡å‘é‡æ•°æ®åº“
- [Weaviate](https://weaviate.io/developers/weaviate) - å¼€æºå‘é‡æ•°æ®åº“
- [Qdrant](https://qdrant.tech/documentation/) - é«˜æ€§èƒ½å‘é‡æ•°æ®åº“

### ç›¸å…³æ–‡ç« 

- [Building RAG Applications](https://blog.langchain.dev/rag/)
- [Vector Embeddings Explained](https://www.pinecone.io/learn/vector-embeddings/)
- [Semantic Search with OpenAI](https://platform.openai.com/docs/guides/semantic-search)

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

**å¦‚ä½•è´¡çŒ®**ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m "Add your feature"`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/your-feature`
5. æäº¤ Pull Request

---

## ğŸ“„ è®¸å¯è¯

ISC License

---

**ç¥å­¦ä¹ æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æ Issue è®¨è®ºã€‚** ğŸ‰
